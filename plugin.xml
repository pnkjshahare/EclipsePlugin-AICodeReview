<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>

<plugin>

   <!-- ðŸ”¥ Auto-start plugin at Eclipse workbench startup -->
   <extension point="org.eclipse.ui.startup">
      <startup class="com.ai.codereview.plugin.StartupTrigger"/>
   </extension>

   <!-- ðŸ§© Commands -->
   <extension point="org.eclipse.ui.commands">
      <!-- Existing command for code review -->
      <command
            id="com.ai.codereview.plugin.runReview"
            name="Run Code Review"/>

      <!-- New command to open the AI Review Panel -->
      <command
            id="com.ai.codereview.plugin.openReviewPanel"
            name="Open AI Review Panel"/>
   </extension>

   <!-- ðŸ§  Handlers -->
   <extension point="org.eclipse.ui.handlers">
      <!-- Existing handler for code review -->
      <handler
            commandId="com.ai.codereview.plugin.runReview"
            class="com.ai.codereview.plugin.GitChangeListener"/>

      <!-- New handler to open the panel -->
      <handler
            commandId="com.ai.codereview.plugin.openReviewPanel"
            class="com.ai.codereview.plugin.OpenPanelHandler"/>
   </extension>

   <!-- ðŸ§° Old Help Menu entry (you can delete if not needed) -->
   <extension point="org.eclipse.ui.menus">
      <menuContribution locationURI="menu:help?after=additions">
         <command
               commandId="com.ai.codereview.plugin.runReview"
               label="Run AI Code Review"
               style="push"/>
      </menuContribution>
   </extension>

   <!-- â­ Add TOP MENU: AI Tools -->
   <extension point="org.eclipse.ui.menus">
      <menuContribution locationURI="menu:org.eclipse.ui.main.menu?after=window">
         
         <!-- Create AI Tools menu -->
         <menu
               id="com.ai.codereview.plugin.menu"
               label="AI Tools">

            <!-- Open panel -->
            <command
                  commandId="com.ai.codereview.plugin.openReviewPanel"
                  label="Open AI Review Panel"
                  style="push"/>

            <!-- Run Code Review -->
            <command
                  commandId="com.ai.codereview.plugin.runReview"
                  label="Run Code Review"
                  style="push"/>

         </menu>
      </menuContribution>
   </extension>

   <!-- â­ View Category -->
   <extension point="org.eclipse.ui.views">
      <category
           id="com.ai.codereview.plugin.category"
           name="AI Tools"/>
   </extension>

   <!-- â­ Custom Panel (View) -->
   <extension point="org.eclipse.ui.views">
      <view
            id="com.ai.codereview.plugin.aiReviewPanel"
            name="AI Review Panel"
            class="com.ai.codereview.plugin.AIReviewPanel"
            category="com.ai.codereview.plugin.category"/>
   </extension>

   <!-- â­ Auto-place panel in bottom area next to Console -->
   <extension point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension targetID="org.eclipse.ui.resourcePerspective">
         <view
               id="com.ai.codereview.plugin.aiReviewPanel"
               relationship="stack"
               relative="org.eclipse.ui.console.ConsoleView"
               visible="true"/>
      </perspectiveExtension>
   </extension>

</plugin>
